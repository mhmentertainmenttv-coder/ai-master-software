<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWER Admin Panel</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        
        /* Login Screen Design */
        #login-screen { display: flex; justify-content: center; align-items: center; height: 100vh; background: #004d40; }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 320px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .login-box h2 { color: #004d40; margin-bottom: 20px; }
        .login-box select, .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .login-box button { width: 100%; padding: 12px; background: #004d40; color: white; border: none; font-size: 16px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-box button:hover { background: #00332a; }

        /* Dashboard Design */
        #dashboard { display: none; padding: 20px; max-width: 1200px; margin: auto; }
        .header { background: white; padding: 15px 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; margin-left: 5px; font-size: 14px; text-decoration: none; display: inline-block; }
        
        /* Button Colors */
        .btn-call { background: #0288d1; }  
        .btn-wa { background: #25d366; }    
        .btn-cert { background: #ff9800; }  
        .btn-logout { background: #d32f2f; } 
        
        /* Search & Filter Bar */
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .filters input, .filters select { padding: 10px; flex: 1; border: 1px solid #ddd; border-radius: 5px; min-width: 150px; }

        /* Card Container */
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        /* Individual Card */
        .data-card { background: white; padding: 20px; border-radius: 10px; border-top: 5px solid #004d40; box-shadow: 0 3px 6px rgba(0,0,0,0.1); position: relative; transition: transform 0.2s; }
        .data-card:hover { transform: translateY(-3px); }
        
        .photo-box { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; position: absolute; top: 15px; right: 15px; border: 2px solid #eee; }
        
        .data-card h3 { margin: 0 0 5px 0; color: #333; font-size: 18px; padding-right: 60px; }
        .badge { background: #e0f2f1; color: #004d40; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 10px; }
        .data-card p { margin: 5px 0; font-size: 14px; color: #555; line-height: 1.4; }
        
        .action-bar { margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap; border-top: 1px solid #eee; padding-top: 15px; }
        .action-bar a, .action-bar button { flex: 1; text-align: center; font-size: 13px; }

        /* Certificate Design (Hidden) */
        #cert-print { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; text-align: center; overflow-y: auto; }
        .cert-border { border: 10px double #004d40; padding: 40px; max-width: 800px; margin: 20px auto; background: #fff; position: relative; min-height: 90vh; box-sizing: border-box; }
        
        @media print {
            body * { visibility: hidden; }
            #cert-print, #cert-print * { visibility: visible; }
            #cert-print { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#004d40;">üîê TWER Admin</h2>
            <label style="display:block; text-align:left; font-weight:bold; font-size:12px; color:#555;">Select Role:</label>
            <select id="role">
                <option value="Admin">Master Admin (Full Access)</option>
                <option value="SubAdmin">Sub Admin (Staff View)</option>
            </select>
            <input type="password" id="password" placeholder="Enter Password">
            <button onclick="handleLogin()">Login Dashboard</button>
        </div>
    </div>

    <div id="dashboard">
        <div class="header">
            <div>
                <h2 style="margin:0; color:#004d40;">Admin Dashboard</h2>
                <span id="user-display" style="font-size:14px; color:gray;">Checking login...</span>
            </div>
            <div>
                <button class="btn" style="background:green;" onclick="location.href='https://docs.google.com/spreadsheets'">üìÑ Google Sheet</button>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="filters">
            <input type="text" id="search" placeholder="üîç Search by Name or Mobile..." onkeyup="filterData()">
            <select id="filterType" onchange="filterData()">
                <option value="All">All Categories</option>
                <option value="Student">Student</option>
                <option value="Institute">Institute</option>
                <option value="Practitioner">Practitioner</option>
                <option value="Dealer">Dealer</option>
            </select>
            <button class="btn" style="background:#333;" onclick="loadData()">üîÑ Refresh Data</button>
        </div>

        <div id="loading" style="text-align:center; display:none; padding:20px;">
            <p style="font-size:18px; color:#004d40; font-weight:bold;">‚è≥ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç...</p>
        </div>
        
        <div id="data-container" class="card-container"></div>
    </div>

    <div id="cert-print">
        <div class="cert-border">
            <h1 style="color:#004d40; font-size:42px; margin-bottom:5px; font-family:serif;">CERTIFICATE OF REGISTRATION</h1>
            <h3 style="margin-top:0; font-size:24px; color:#333;">THE WORLD EDUCATION RESEARCH (TWER)</h3>
            <p style="font-size:16px; color:#555;">Electro Homeopathic Board & Council, Patna</p>
            <hr style="width:70%; border-top:3px solid #004d40; margin: 20px auto;">
            <br><br>
            <p style="font-size:22px; font-style: italic;">This is to certify that</p>
            <h1 id="c-name" style="color:#d32f2f; font-family:cursive; font-size:48px; margin:15px 0;">Student Name</h1>
            <p style="font-size:20px;">Son/Daughter of <b id="c-father">Father Name</b></p>
            <p style="font-size:20px;">Has been successfully registered for the course/category:</p>
            <h2 id="c-type" style="text-decoration: underline; color:#004d40;">Course Name</h2>
            <br><br>
            <div style="display:flex; justify-content:space-between; margin-top:40px; padding:0 60px;">
                <p style="font-size:18px;"><b>Reg No:</b> <span id="c-id">ID-0000</span></p>
                <p style="font-size:18px;"><b>Date:</b> <span id="c-date">01/01/2026</span></p>
            </div>
            <br><br><br><br>
            <div style="display:flex; justify-content:space-between; padding:0 60px;">
                <div style="text-align:center;"><b>______________________</b><br>Secretary Signature</div>
                <div style="text-align:center;"><b>______________________</b><br>President Signature</div>
            </div>
            <br><br>
            <div class="no-print" style="margin-top:30px;">
                <button onclick="window.print()" style="padding:15px 30px; background:blue; color:white; border:none; cursor:pointer; font-size:18px; border-radius:5px; margin-right:10px;">üñ®Ô∏è Print / Save PDF</button>
                <button onclick="closeCert()" style="padding:15px 30px; background:red; color:white; border:none; cursor:pointer; font-size:18px; border-radius:5px;">‚ùå Close</button>
            </div>
        </div>
    </div>

<script>
    // ‚úÖ ‡§Ü‡§™‡§ï‡•Ä ‡§®‡§à ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à
    const API_URL = "https://script.google.com/macros/s/AKfycbyvhiyDv1m_7wEDwfxapaymNel3xSy4qB3ArYT7HrbJKWdcsO_LBXYceNU64xI8lFAp/exec"; 

    let allData = [];
    let userRole = "";

    function handleLogin() {
        const role = document.getElementById('role').value;
        const pass = document.getElementById('password').value;

        // üü¢ MASTER ADMIN
        if (role === "Admin" && pass === "1979") {
            userRole = "Master Admin";
            loginSuccess();
        } 
        // üü° SUB ADMIN / STAFF
        else if (role === "SubAdmin" && pass === "1234") {
            userRole = "Sub Admin";
            loginSuccess();
        } else {
            alert("‚ùå ‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
        }
    }

    function loginSuccess() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('user-display').innerText = "Logged in as: " + userRole;
        loadData();
    }

    function logout() { location.reload(); }

    function loadData() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('data-container').innerHTML = "";
        
        fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            allData = data;
            document.getElementById('loading').style.display = 'none';
            renderData(data);
        })
        .catch(err => {
            document.getElementById('loading').innerHTML = "<p style='color:red;'>Failed to load data. Please check internet or script link.</p>";
            console.error(err);
        });
    }

    function renderData(data) {
        const container = document.getElementById('data-container');
        container.innerHTML = "";

        if(data.length === 0) {
            container.innerHTML = "<p style='text-align:center; width:100%;'>No Records Found.</p>";
            return;
        }

        // ‡§®‡§è ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç (Reverse order)
        data.slice().reverse().forEach(item => {
            
            // ‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§¨‡§ü‡§® ‡§∏‡§ø‡§∞‡•ç‡§´ Master Admin ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ
            let certBtn = "";
            if (userRole === "Master Admin") {
                certBtn = `<button class="btn btn-cert" onclick="generateCert('${item.name}', '${item.father}', '${item.course || item.type}', '${item.appNo}')">üìú Certificate</button>`;
            }

            let photoHTML = item.photo ? `<img src="${item.photo}" class="photo-box" onclick="window.open('${item.photo}')">` : '';
            
            // ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ‡§∞‡•ç‡§°
            let card = `
                <div class="data-card">
                    ${photoHTML}
                    <h3 style="margin-top:0;">${item.name}</h3>
                    <span class="badge">${item.type}</span>
                    
                    <p><b>üìû Mobile:</b> ${item.mobile}</p>
                    <p><b>üÜî ID:</b> ${item.appNo}</p>
                    <p><b>üë®‚Äçüë¶ Father:</b> ${item.father}</p>
                    <p><b>üìö Info:</b> ${item.course || 'N/A'}</p>
                    <p><b>üìÖ Date:</b> ${new Date(item.date).toLocaleDateString()}</p>
                    
                    <div class="action-bar">
                        <a href="tel:${item.mobile}" class="btn btn-call">üìû Call</a>
                        <a href="https://wa.me/91${item.mobile}?text=Namaste ${item.name}, TWER Board contacting you regarding your application." target="_blank" class="btn btn-wa">üí¨ WhatsApp</a>
                        ${certBtn}
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    }

    function filterData() {
        const search = document.getElementById('search').value.toLowerCase();
        const type = document.getElementById('filterType').value;

        const filtered = allData.filter(item => {
            const matchesSearch = String(item.name).toLowerCase().includes(search) || String(item.mobile).includes(search) || String(item.appNo).toLowerCase().includes(search);
            const matchesType = type === "All" || item.type === type;
            return matchesSearch && matchesType;
        });
        renderData(filtered);
    }

    // ‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§ú‡§®‡§∞‡•á‡§ü‡§∞
    function generateCert(name, father, type, id) {
        document.getElementById('c-name').innerText = name;
        document.getElementById('c-father').innerText = father;
        document.getElementById('c-type').innerText = type;
        document.getElementById('c-id').innerText = id;
        document.getElementById('c-date').innerText = new Date().toLocaleDateString();
        
        document.getElementById('cert-print').style.display = 'block';
    }

    function closeCert() {
        document.getElementById('cert-print').style.display = 'none';
    }
</script>
</body>
</html>
