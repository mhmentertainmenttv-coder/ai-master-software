<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWER Admin Panel</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        
        #login-screen { display: flex; justify-content: center; align-items: center; height: 100vh; background: #004d40; }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 300px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .login-box select, .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .login-box button { width: 100%; padding: 12px; background: #004d40; color: white; border: none; font-size: 16px; border-radius: 5px; cursor: pointer; }

        #dashboard { display: none; padding: 15px; }
        .header { background: white; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; color: white; margin-left: 5px; text-decoration: none; }
        
        .btn-call { background: #0288d1; }  
        .btn-wa { background: #25d366; }    
        .btn-cert { background: #ff9800; }  
        .btn-logout { background: #d32f2f; } 
        
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filters input, .filters select { padding: 10px; flex: 1; border: 1px solid #ccc; border-radius: 5px; }

        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .data-card { background: white; padding: 15px; border-radius: 10px; border-top: 5px solid #004d40; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
        .photo-box { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; position: absolute; top: 15px; right: 15px; border: 2px solid #eee; }
        
        .action-bar { margin-top: 15px; display: flex; gap: 5px; flex-wrap: wrap; border-top: 1px solid #eee; padding-top: 10px; }
        .action-bar a, .action-bar button { flex: 1; text-align: center; }

        #cert-print { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; text-align: center; overflow-y: auto; }
        .cert-border { border: 10px double #004d40; padding: 40px; max-width: 800px; margin: 20px auto; background: #fff; position: relative; }
        
        @media print {
            body * { visibility: hidden; }
            #cert-print, #cert-print * { visibility: visible; }
            #cert-print { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#004d40;">üîê TWER Admin</h2>
            <select id="role">
                <option value="Admin">Master Admin</option>
                <option value="SubAdmin">Sub Admin</option>
            </select>
            <input type="password" id="password" placeholder="Password">
            <button onclick="handleLogin()">Login Dashboard</button>
        </div>
    </div>

    <div id="dashboard">
        <div class="header">
            <div>
                <h3 style="margin:0; color:#004d40;">Admin Panel</h3>
                <small id="user-display" style="color:gray;">--</small>
            </div>
            <div>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="filters">
            <input type="text" id="search" placeholder="üîç Search Name/Mobile..." onkeyup="filterData()">
            <select id="filterType" onchange="filterData()">
                <option value="All">All Categories</option>
                <option value="Student">Student</option>
                <option value="Institute">Institute</option>
                <option value="Practitioner">Practitioner</option>
                <option value="Dealer">Dealer</option>
            </select>
            <button class="btn" style="background:#333;" onclick="loadData()">üîÑ Refresh</button>
        </div>

        <p id="total-count" style="text-align:center; font-weight:bold; color:#004d40;"></p>
        <div id="loading" style="text-align:center; display:none;">‚è≥ Loading Data...</div>
        <div id="data-container" class="card-container"></div>
    </div>

    <div id="cert-print">
        <div class="cert-border">
            <h1 style="color:#004d40; font-family:serif;">CERTIFICATE OF REGISTRATION</h1>
            <h3>THE WORLD EDUCATION RESEARCH (TWER)</h3>
            <p>Electro Homeopathic Board, Patna</p>
            <hr style="width:70%; margin:20px auto;">
            <br>
            <p>This is to certify that</p>
            <h1 id="c-name" style="color:#d32f2f; font-family:cursive;">Name</h1>
            <p>Son/Daughter of <b id="c-father">Father</b></p>
            <p>Has been registered for <b id="c-type">Course</b></p>
            <br>
            <div style="display:flex; justify-content:space-between; padding:0 50px;">
                <p><b>Reg No:</b> <span id="c-id">ID</span></p>
                <p><b>Date:</b> <span id="c-date">Date</span></p>
            </div>
            <br><br><br>
            <div style="display:flex; justify-content:space-between; padding:0 50px;">
                <b>__________<br>Secretary</b>
                <b>__________<br>President</b>
            </div>
            <br><br>
            <button onclick="window.print()" class="no-print btn btn-call">üñ®Ô∏è Print</button>
            <button onclick="closeCert()" class="no-print btn btn-logout">‚ùå Close</button>
        </div>
    </div>

<script>
    // ‚úÖ ‡§Ü‡§™‡§ï‡•Ä ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ó‡§æ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à
    const API_URL = "https://script.google.com/macros/s/AKfycbyvhiyDv1m_7wEDwfxapaymNel3xSy4qB3ArYT7HrbJKWdcsO_LBXYceNU64xI8lFAp/exec"; 

    let allData = [];
    let userRole = "";

    function handleLogin() {
        const role = document.getElementById('role').value;
        const pass = document.getElementById('password').value;
        if ((role === "Admin" && pass === "1979") || (role === "SubAdmin" && pass === "1234")) {
            userRole = role;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('user-display').innerText = "Logged in: " + userRole;
            loadData();
        } else {
            alert("‚ùå Wrong Password!");
        }
    }

    function logout() { location.reload(); }

    function loadData() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('data-container').innerHTML = "";
        
        fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            allData = data;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('total-count').innerText = "Total Records: " + data.length;
            renderData(data);
        })
        .catch(err => {
            document.getElementById('loading').innerHTML = "Error loading data. Check internet.";
        });
    }

    function renderData(data) {
        const container = document.getElementById('data-container');
        container.innerHTML = "";

        if(data.length === 0) {
            container.innerHTML = "<p>No Data Found.</p>"; return;
        }

        // Reverse to show newest first
        data.slice().reverse().forEach(item => {
            let certBtn = (userRole === "Admin") ? `<button class="btn btn-cert" onclick="generateCert('${item.name}', '${item.father}', '${item.course || item.type}', '${item.appNo}')">üìú Cert</button>` : "";
            let photoHTML = item.photo ? `<img src="${item.photo}" class="photo-box">` : '';

            let card = `
                <div class="data-card">
                    ${photoHTML}
                    <h3 style="margin-right:60px;">${item.name}</h3>
                    <span style="background:#eee; padding:2px 5px; font-size:12px;">${item.type}</span>
                    <p><b>ID:</b> ${item.appNo}</p>
                    <p><b>Father:</b> ${item.father}</p>
                    <p><b>Date:</b> ${new Date(item.date).toLocaleDateString()}</p>
                    <div class="action-bar">
                        <a href="tel:${item.mobile}" class="btn btn-call">üìû Call</a>
                        <a href="https://wa.me/91${item.mobile}?text=Namaste ${item.name}..." target="_blank" class="btn btn-wa">üí¨ WhatsApp</a>
                        ${certBtn}
                    </div>
                </div>`;
            container.innerHTML += card;
        });
    }

    function filterData() {
        const search = document.getElementById('search').value.toLowerCase();
        const type = document.getElementById('filterType').value;
        const filtered = allData.filter(item => {
            return (String(item.name).toLowerCase().includes(search) || String(item.mobile).includes(search)) && (type === "All" || item.type === type);
        });
        renderData(filtered);
    }

    function generateCert(n, f, t, i) {
        document.getElementById('c-name').innerText = n;
        document.getElementById('c-father').innerText = f;
        document.getElementById('c-type').innerText = t;
        document.getElementById('c-id').innerText = i;
        document.getElementById('c-date').innerText = new Date().toLocaleDateString();
        document.getElementById('cert-print').style.display = 'block';
    }
    function closeCert() { document.getElementById('cert-print').style.display = 'none'; }
</script>
</body>
</html>
